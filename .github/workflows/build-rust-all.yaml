name: Build Xtensa Rust toolchain

on:
  workflow_dispatch:
    inputs:
      release_version:
        description: "Xtensa Rust release version to build"
        required: true
        default: '1.73.0.1'
      release_tag:
        description: "Release tag where artifacts will be stored (e.g. v1.73.0.1, untagged-00000)"
        required: true
        default: "untagged-3ecdd54e672f465cad2e"

jobs:
  launch_workflows:
    name: ${{ matrix.workflow_name.target }}
    runs-on: ubuntu-latest

    strategy:
      matrix:
        workflow_name:
          - target: aarch64-apple-darwin
            workflow: build-rust-aarch64-apple-darwin-self-hosted-dispatch.yaml
          - target: aarch64-unknown-linux-gnu
            workflow: build-rust-aarch64-unknown-linux-gnu-self-hosted-dispatch.yaml
          - target: x86_64-apple-darwin
            workflow: build-rust-x86_64-apple-darwin-self-hosted-dispatch.yaml
          - target: x86_64-pc-windows-gnu
            workflow: build-rust-x86_64-pc-windows-gnu-self-hosted-dispatch.yaml
          - target: x86_64-pc-windows-msvc
            workflow: build-rust-x86_64-pc-windows-msvc-self-hosted-dispatch.yaml
          - target: x86_64-unknown-linux-gnu
            workflow: build-rust-x86_64-unknown-linux-gnu-self-hosted-dispatch.yaml
          - target: rust-src
            workflow: build-rust-src-dispatch.yaml

    steps:
      - uses: actions/checkout@v4
      - name: Run ${{ matrix.workflow_name }} workflow
        run: |
          curl -L \
            -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer ${{ secrets.PAT }}" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            https://api.github.com/repos/esp-rs/rust-build/actions/workflows/${{ matrix.workflow_name.workflow }}/dispatches \
            -d '{"ref":"${{ github.ref_name }}", "inputs": { "release_version":"${{ github.event.inputs.release_version }}", "release_tag":"${{ github.event.inputs.release_tag }}" }}'
