name: Build Xtensa Rust toolchain

on:
  workflow_dispatch:
    inputs:
      release_version:
        description: "Xtensa Rust release version to build"
        required: true
        default: '1.73.0.0'
      release_tag:
        description: "Release tag where artifacts will be stored (e.g. v1.73.0.0, untagged-00000)"
        required: true
        default: "untagged-3ecdd54e672f465cad2e"

jobs:
  launch_workflows:
    name: ${{ matrix.target }}
    runs-on: ubuntu-latest

    strategy:
      matrix:
        target: [aarch64-apple-darwin, aarch64-unknown-linux-gnu, x86_64-apple-darwin, x86_64-pc-windows-gnu, x86_64-pc-windows-msvc, x86_64-unknown-linux-gnu, rust-src]

    steps:
      - uses: actions/checkout@v4
      - name: Run ${{ matrix.target }} workflow
        run: |
          curl -L \
            -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer ${{ secrets.PAT }}" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            https://api.github.com/repos/esp-rs/rust-build/actions/workflows/build-${{ matrix.target }}.yaml/dispatches \
            -d '{"ref":"${{ github.ref_name }}", "inputs": { "release_version":"${{ github.event.inputs.release_version }}", "release_tag":"${{ github.event.inputs.release_tag }}" }}'
